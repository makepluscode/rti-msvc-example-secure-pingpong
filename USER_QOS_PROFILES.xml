<?xml version="1.0"?>
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation="C:/Program Files/rti_connext_dds-7.5.0/resource/schema/rti_dds_qos_profiles.xsd">
    <!-- 
      QoS 라이브러리 정의 
      DDS 애플리케이션은 이 프로파일을 로드하여 통신 설정을 결정합니다.
    -->
    <qos_library name="PingPong_Library">
        <qos_profile name="PingPong_Profile" is_default_qos="true">
            <participant_qos>
                <participant_name>
                    <name>RTI Ping-Pong Participant</name>
                </participant_name>
            </participant_qos>
            
            <datareader_qos>
                <!-- 신뢰성 있는 통신 설정 (메시지 유실 시 재전송) -->
                <reliability>
                    <kind>RELIABLE_RELIABILITY_QOS</kind>
                </reliability>
                <!-- 최신 1개 메시지만 큐에 보관 -->
                <history>
                    <kind>KEEP_LAST_HISTORY_QOS</kind>
                    <depth>1</depth>
                </history>
            </datareader_qos>

            <datawriter_qos>
                <reliability>
                    <kind>RELIABLE_RELIABILITY_QOS</kind>
                </reliability>
                <history>
                    <kind>KEEP_LAST_HISTORY_QOS</kind>
                    <depth>1</depth>
                </history>
            </datawriter_qos>
        </qos_profile>
    </qos_library>

    <!-- 보안(Security) 관련 설정 라이브러리 -->
    <qos_library name="Security_Library">
        <qos_profile name="Secure_PingPong_Profile" base_name="PingPong_Library::PingPong_Profile">
            <participant_qos>
                <property>
                    <value>
                        <!-- 보안 플러그인 활성화 -->
                        <element>
                            <name>com.rti.serv.load_plugin</name>
                            <value>com.rti.serv.secure.library</value>
                        </element>

                        <!-- 인증(Authentication) 설정 -->
                        <element>
                            <name>dds.sec.auth.builtin.PKI-DH.identity_ca</name>
                            <value>certs/identity_ca_cert.pem</value>
                        </element>
                        <element>
                            <name>dds.sec.auth.builtin.PKI-DH.identity_certificate</name>
                            <value>certs/app1_cert.pem</value>
                        </element>
                        <element>
                            <name>dds.sec.auth.builtin.PKI-DH.private_key</name>
                            <value>certs/app1_key.pem</value>
                        </element>

                        <!-- 권한 제어(Access Control) 설정 -->
                        <element>
                            <name>dds.sec.access_control.builtin.PKI-DH.permissions_ca</name>
                            <value>certs/permissions_ca_cert.pem</value>
                        </element>
                        <element>
                            <name>dds.sec.access_control.builtin.PKI-DH.governance</name>
                            <value>certs/governance.p7s</value>
                        </element>
                        <element>
                            <name>dds.sec.access_control.builtin.PKI-DH.permissions</name>
                            <value>certs/permissions.p7s</value>
                        </element>

                        <!-- 암호화(Cryptography) 설정 -->
                        <element>
                            <name>dds.sec.crypto.builtin.AES-GCM.library</name>
                            <value>nddssecurity</value>
                        </element>
                    </value>
                </property>
            </participant_qos>
        </qos_profile>

        <!-- App2 전용 보안 프로파일 (인증서 및 키 변경) -->
        <qos_profile name="Secure_PingPong_Profile_App2" base_name="Secure_PingPong_Profile">
            <participant_qos>
                <property>
                    <value>
                        <element>
                            <name>dds.sec.auth.builtin.PKI-DH.identity_certificate</name>
                            <value>certs/app2_cert.pem</value>
                        </element>
                        <element>
                            <name>dds.sec.auth.builtin.PKI-DH.private_key</name>
                            <value>certs/app2_key.pem</value>
                        </element>
                    </value>
                </property>
            </participant_qos>
        </qos_profile>
    </qos_library>
</dds>
